<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>口味偏好設定</title>
    <style>
        body {
            height: 100dvh;
            font-family: sans-serif;
            /* 使用無襯線字體 */
            background: linear-gradient(to bottom right, #fff7ed, #fee2e2);
            /* 模擬 bg-gradient-to-br from-orange-50 to-red-50 */
            color: #1f2937;
            /* 模擬 text-gray-900 */
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        .container {
            max-width: 960px;
            /* 模擬 max-w-4xl */
            margin: 0 auto;
            /* 模擬 mx-auto */
            padding: 32px 16px;
            /* 模擬 px-4 py-8 */
        }

        header {
            text-align: center;
            /* 模擬 text-center */
            margin-bottom: 48px;
            /* 模擬 mb-12 */
        }

        header h1 {
            font-size: 36px;
            /* 模擬 text-4xl */
            font-weight: bold;
            /* 模擬 font-bold */
            margin-bottom: 16px;
            /* 模擬 mb-4 */
            color: #1f2937;
            /* 模擬 text-gray-900 */
        }

        header p {
            font-size: 20px;
            /* 模擬 text-xl */
            color: #4b5563;
            /* 模擬 text-gray-600 */
            max-width: 672px;
            /* 模擬 max-w-2xl */
            margin: 0 auto;
        }

        .card {
            background-color: rgba(255, 255, 255, 0.9);
            /* 模擬 bg-white/90 */
            backdrop-filter: blur(8px);
            /* 模擬 backdrop-blur */
            border-radius: 8px;
            /* 模擬 rounded */
            padding: 24px;
            /* 模擬 p-6 */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            /* 模擬 shadow */
            max-width: 600px;
            /* 調整卡片最大寬度以容納表單 */
            margin: 0 auto;
            /* 模擬 mx-auto */
        }

        .card h1 {
            font-size: 24px;
            /* 模擬 text-2xl */
            font-weight: bold;
            /* 模擬 font-bold */
            margin-top: 0;
            margin-bottom: 16px;
            /* 模擬 mb-4 */
            color: #1f2937;
            /* 模擬 text-gray-900 */
            text-align: center;
            /* 卡片內的標題置中 */
        }

        .form-group {
            margin-bottom: 16px;
            /* 增加表單組間距 */
        }

        .form-group label {
            display: block;
            /* 讓 label 佔滿一行 */
            font-weight: 600;
            /* 模擬 font-semibold */
            color: #1f2937;
            /* 模擬 text-gray-900 */
        }

        .form-group input[type="range"] {
            /* Remove or modify range input styles */
            width: 100%;
            /* 讓 range input 佔滿寬度 */
        }

        .button {
            line-height: normal;
            display: block;
            /* 讓按鈕佔滿一行 */
            width: 100%;
            /* 讓按鈕佔滿寬度 */
            padding: 12px 24px;
            /* 模擬 Button padding */
            background-color: #f97316;
            /* 模擬 bg-orange-600 */
            color: white;
            text-decoration: none;
            border: none;
            /* 移除按鈕預設邊框 */
            border-radius: 6px;
            /* 模擬 rounded */
            font-weight: 600;
            /* 模擬 font-semibold */
            cursor: pointer;
            /* 顯示手型游標 */
            transition: background-color 0.2s ease-in-out;
            font-size: 16px;
            /* 模擬 Button 字體大小 */
        }

        .button:hover {
            background-color: #ea580c;
            /* 模擬 hover:bg-orange-700 */
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .form-page {
            display: none;
            /* Hide all pages by default */
            display: flex;
            /* Use flexbox for page content */
            flex-direction: column;
            /* Stack content vertically */
            justify-content: space-between;
            /* Push buttons to the bottom */
            height: 100%;
            /* Ensure page takes full height to push buttons down */
        }

        .form-page:first-child {
            display: flex;
            /* Show the first page */
        }

        .button-container {
            display: flex;
            justify-content: space-between;
            /* Align buttons left and right */
            margin-top: 20px;
            /* Add some space above buttons */
        }

        .button-container .button {
            width: auto;
            /* Allow buttons to size based on content */
            display: inline-block;
            /* Display buttons inline */
        }

        /* New styles for allergen form group */
        .allergen-form-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            /* Center items horizontally */
            margin-bottom: 16px;
            /* Keep existing margin */
        }

        .allergen-form-group label {
            margin-bottom: 8px;
            /* Keep existing margin */
            font-size: 20px;
            /* Increase font size */
        }

        .allergen-form-group select {
            padding: 10px;
            /* Increase padding */
            font-size: 18px;
            /* Increase font size */
            width: 80%;
            /* Set a specific width */
            box-sizing: border-box;
            /* Include padding in the element's total width */
        }

        /* New styles for radio button group */
        .radio-group {
            display: flex;
            flex-direction: column;
            /* Arrange radio buttons vertically */
            gap: 12px;
            /* Space between radio button options, increased from 8px */
            margin-top: 12px;
            /* Space between label and options, increased from 8px */
        }

        .radio-group div {
            display: flex;
            align-items: center;
        }

        .radio-group input[type="radio"] {
            margin-top: 0;
            margin-right: 10px;
            /* Space between radio button and label, increased from 8px */
            width: 20px;
            /* Increase radio button size */
            height: 20px;
            /* Increase radio button size */
        }

        .radio-group label {
            font-size: 18px;
            /* Increase font size for labels */
            font-weight: normal;
            /* Reset font-weight if needed, or keep bold */
            color: #1f2937;
            /* Match existing text color */
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="card">
            <h1>請設定您的拉麵口味偏好</h1>
            <form action="end_page.html" method="get">
                <!-- Page 1: 酸 -->
                <div class="form-page">
                    <div class="form-group">
                        <label>對酸的喜愛度:</label>
                        <div class="radio-group">
                            <div>
                                <input type="radio" id="sour-1" name="sour" value="1">
                                <label for="sour-1">1</label>
                            </div>
                            <div>
                                <input type="radio" id="sour-2" name="sour" value="2">
                                <label for="sour-2">2</label>
                            </div>
                            <div>
                                <input type="radio" id="sour-3" name="sour" value="3">
                                <label for="sour-3">3</label>
                            </div>
                            <div>
                                <input type="radio" id="sour-4" name="sour" value="4">
                                <label for="sour-4">4</label>
                            </div>
                            <div>
                                <input type="radio" id="sour-5" name="sour" value="5">
                                <label for="sour-5">5</label>
                            </div>
                        </div>
                    </div>
                    <div class="button-container">
                        <a type="button" href="/" class="button">
                            返回
                        </a>
                        <button type="button" class="button next-page">繼續</button>
                    </div>
                </div>

                <!-- Page 2: 甜 -->
                <div class="form-page">
                    <div class="form-group">
                        <label>對甜的喜愛度:</label>
                        <div class="radio-group">
                            <div>
                                <input type="radio" id="sweet-1" name="sweet" value="1">
                                <label for="sweet-1">1</label>
                            </div>
                            <div>
                                <input type="radio" id="sweet-2" name="sweet" value="2">
                                <label for="sweet-2">2</label>
                            </div>
                            <div>
                                <input type="radio" id="sweet-3" name="sweet" value="3">
                                <label for="sweet-3">3</label>
                            </div>
                            <div>
                                <input type="radio" id="sweet-4" name="sweet" value="4">
                                <label for="sweet-4">4</label>
                            </div>
                            <div>
                                <input type="radio" id="sweet-5" name="sweet" value="5">
                                <label for="sweet-5">5</label>
                            </div>
                        </div>
                    </div>
                    <div class="button-container">
                        <button type="button" class="button prev-page">返回</button>
                        <button type="button" class="button next-page">繼續</button>
                    </div>
                </div>

                <!-- Page 3: 鹹 -->
                <div class="form-page">
                    <div class="form-group">
                        <label>對鹹的喜愛度:</label>
                        <div class="radio-group">
                            <div>
                                <input type="radio" id="salty-1" name="salty" value="1">
                                <label for="salty-1">1</label>
                            </div>
                            <div>
                                <input type="radio" id="salty-2" name="salty" value="2">
                                <label for="salty-2">2</label>
                            </div>
                            <div>
                                <input type="radio" id="salty-3" name="salty" value="3">
                                <label for="salty-3">3</label>
                            </div>
                            <div>
                                <input type="radio" id="salty-4" name="salty" value="4">
                                <label for="salty-4">4</label>
                            </div>
                            <div>
                                <input type="radio" id="salty-5" name="salty" value="5">
                                <label for="salty-5">5</label>
                            </div>
                        </div>
                    </div>
                    <div class="button-container">
                        <button type="button" class="button prev-page">返回</button>
                        <button type="button" class="button next-page">繼續</button>
                    </div>
                </div>

                <!-- Page 4: 苦 -->
                <div class="form-page">
                    <div class="form-group">
                        <label>對苦的喜愛度:</label>
                        <div class="radio-group">
                            <div>
                                <input type="radio" id="bitter-1" name="bitter" value="1">
                                <label for="bitter-1">1</label>
                            </div>
                            <div>
                                <input type="radio" id="bitter-2" name="bitter" value="2">
                                <label for="bitter-2">2</label>
                            </div>
                            <div>
                                <input type="radio" id="bitter-3" name="bitter" value="3">
                                <label for="bitter-3">3</label>
                            </div>
                            <div>
                                <input type="radio" id="bitter-4" name="bitter" value="4">
                                <label for="bitter-4">4</label>
                            </div>
                            <div>
                                <input type="radio" id="bitter-5" name="bitter" value="5">
                                <label for="bitter-5">5</label>
                            </div>
                        </div>
                    </div>
                    <div class="button-container">
                        <button type="button" class="button prev-page">返回</button>
                        <button type="button" class="button next-page">繼續</button>
                    </div>
                </div>

                <!-- Page 5: 鮮 -->
                <div class="form-page">
                    <div class="form-group">
                        <label>對鮮味的喜愛度:</label>
                        <div class="radio-group">
                            <div>
                                <input type="radio" id="umami-1" name="umami" value="1">
                                <label for="umami-1">1</label>
                            </div>
                            <div>
                                <input type="radio" id="umami-2" name="umami" value="2">
                                <label for="umami-2">2</label>
                            </div>
                            <div>
                                <input type="radio" id="umami-3" name="umami" value="3">
                                <label for="umami-3">3</label>
                            </div>
                            <div>
                                <input type="radio" id="umami-4" name="umami" value="4">
                                <label for="umami-4">4</label>
                            </div>
                            <div>
                                <input type="radio" id="umami-5" name="umami" value="5">
                                <label for="umami-5">5</label>
                            </div>
                        </div>
                    </div>
                    <div class="button-container">
                        <button type="button" class="button prev-page">返回</button>
                        <button type="button" class="button next-page">繼續</button>
                    </div>
                </div>


                <!-- Page 8: 辣 -->
                <div class="form-page">
                    <div class="form-group">
                        <label>對辣的喜愛度:</label>
                        <div class="radio-group">
                            <div>
                                <input type="radio" id="spicy-1" name="spicy" value="1">
                                <label for="spicy-1">1</label>
                            </div>
                            <div>
                                <input type="radio" id="spicy-2" name="spicy" value="2">
                                <label for="spicy-2">2</label>
                            </div>
                            <div>
                                <input type="radio" id="spicy-3" name="spicy" value="3">
                                <label for="spicy-3">3</label>
                            </div>
                            <div>
                                <input type="radio" id="spicy-4" name="spicy" value="4">
                                <label for="spicy-4">4</label>
                            </div>
                            <div>
                                <input type="radio" id="spicy-5" name="spicy" value="5">
                                <label for="spicy-5">5</label>
                            </div>
                        </div>
                    </div>
                    <div class="button-container">
                        <button type="button" class="button prev-page">返回</button>
                        <!-- <button type="button" class="button next-page">繼續</button> -->
                        <button type="submit" class="button">查看推薦店家</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <script>
        const formPages = document.querySelectorAll('.form-page');
        const nextButtons = document.querySelectorAll('.next-page');
        const prevButtons = document.querySelectorAll('.prev-page');

        let currentPage = 0;

        function showPage(pageIndex) {
            formPages.forEach((page, index) => {
                page.style.display = index === pageIndex ? 'flex' : 'none';
            });
            updateButtonState(); // Call the function to update button state
        }

        function updateButtonState() {
            const currentPageElement = formPages[currentPage];
            const nextButton = currentPageElement.querySelector('.next-page');
            const submitButton = currentPageElement.querySelector('button[type="submit"]');
            let isAnswered = false;

            // Check for select input (Allergen and Ramen Style pages)
            const selectElement = currentPageElement.querySelector('select');
            if (selectElement) {
                isAnswered = selectElement.value !== '';
            } else { // Check for radio button input (all other pages)
                const radioButtons = currentPageElement.querySelectorAll('input[type="radio"]');
                isAnswered = Array.from(radioButtons).some(radio => radio.checked);
            }

            // Enable or disable the next/submit button based on whether the question is answered
            if (nextButton) {
                nextButton.disabled = !isAnswered;
            }
            if (submitButton) {
                submitButton.disabled = !isAnswered;
            }
        }

        nextButtons.forEach(button => {
            button.addEventListener('click', () => {
                currentPage++;
                showPage(currentPage);
            });
        });

        prevButtons.forEach(button => {
            button.addEventListener('click', () => {
                currentPage--;
                showPage(currentPage);
            });
        });

        // Add event listeners to update button state when an answer is selected
        formPages.forEach(page => {
            page.addEventListener('change', updateButtonState);
        });

        // Add event listener for form submission
        const form = document.querySelector('form');
        form.addEventListener('submit', async function (event) { // Use async function for fetch
            event.preventDefault(); // Prevent the default form submission

            const formData = new FormData(form); // Get form data

            // Convert FormData to a plain object
            const formDataObject = {};
            formData.forEach((value, key) => {
                formDataObject[key] = value;
            });

            console.log('Form Data:', formDataObject); // Log the object

            // Define your backend API endpoint
            const apiEndpoint = 'https://ramen-backend-138092490095.asia-east1.run.app/form'; // <<-- 更新為新的後端 API 端點

            // Filter and map form data to match the Ramen schema for the /form endpoint
            const apiData = new URLSearchParams();
            if (formDataObject.hasOwnProperty('sour')) apiData.append('sourness', formDataObject['sour']);
            if (formDataObject.hasOwnProperty('sweet')) apiData.append('sweetness', formDataObject['sweet']);
            if (formDataObject.hasOwnProperty('salty')) apiData.append('saltiness', formDataObject['salty']);
            if (formDataObject.hasOwnProperty('spicy')) apiData.append('spiciness', formDataObject['spicy']);
            if (formDataObject.hasOwnProperty('umami')) apiData.append('umami', formDataObject['umami']);

            try {
                const response = await fetch(apiEndpoint, {
                    method: 'POST', // Method is POST as per API spec
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded' // Specify content type as URL-encoded
                    },
                    body: apiData // Send data as URL-encoded string
                });

                if (!response.ok) {
                    // Handle HTTP errors
                    const errorText = await response.text();
                    throw new Error(`HTTP error! status: ${response.status}, body: ${errorText}`);
                }

                const result = await response.json(); // Parse the JSON response
                console.log('API Response:', result);

                // Store the result in sessionStorage before redirecting
                sessionStorage.setItem('ramenRecommendations', JSON.stringify(result));

                // Redirect to the end page on successful submission
                window.location.href = form.action; // Redirect to end_page.html

            } catch (error) {
                console.error('Error submitting form:', error);
                // Optionally display an error message to the user
                alert('提交表單時發生錯誤，請稍後再試。');
            }
        });

        // Show the first page on load and update button state
        showPage(currentPage);
    </script>
</body>

</html>